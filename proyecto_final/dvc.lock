schema: '2.0'
stages:
  preprocessing:
    cmd: python -m proyecto_final.scripts.run_preprocessing
    deps:
    - path: ../data/raw/energy_efficiency_modified.csv
      hash: md5
      md5: 353c3b5b5f27257faeb0851089d7f594
      size: 43747
    - path: data/preprocessing.py
      hash: md5
      md5: 4cf21b4cef5eff12aebcd10d599b43e0
      size: 10113
    - path: preprocessing/pipeline.py
      hash: md5
      md5: 671faccd998275f3c6480e943cc80418
      size: 5593
    - path: preprocessing/transformers.py
      hash: md5
      md5: 6c05478a78349b2b772561a0c9a7995c
      size: 13639
    outs:
    - path: ../data/interim/energy_efficiency_interim_clean.csv
      hash: md5
      md5: 65871286bac1df6c15d2883841b33c0e
      size: 40840
    - path: ../data/processed/energy_efficiency_test_prepared.csv
      hash: md5
      md5: 77c08a5ca1a06bde232f14d5981895af
      size: 13025
    - path: ../data/processed/energy_efficiency_train_prepared.csv
      hash: md5
      md5: 559c9fcb0a9f3c4d4cd4cd5ba72e4572
      size: 52052
    - path: ../models/encoding_scaling_transformer.joblib
      hash: md5
      md5: 48e9740ac95dad89c5688c6686358164
      size: 3258
    - path: ../models/initial_cleaning_pipeline.joblib
      hash: md5
      md5: 11e58f5807c09bd78cd91c620f112527
      size: 1451
  train_xgboost:
    cmd: HOME=$(pwd)/.. python -m proyecto_final.train --config configs/xgb.yaml
      --skip-preprocessing
    deps:
    - path: ../data/processed/energy_efficiency_test_prepared.csv
      hash: md5
      md5: 77c08a5ca1a06bde232f14d5981895af
      size: 13025
    - path: ../data/processed/energy_efficiency_train_prepared.csv
      hash: md5
      md5: 559c9fcb0a9f3c4d4cd4cd5ba72e4572
      size: 52052
    - path: configs/xgb.yaml
      hash: md5
      md5: 10ea6c79ae6ec3df83265dbfd040c030
      size: 1706
    - path: modeling/trainer.py
      hash: md5
      md5: 055fad3e3d8216e0ba5d6fc3b65b682d
      size: 13297
    params:
      configs/xgb.yaml:
        hpo:
          enabled: true
          search: random
          cv: 5
          scoring: neg_root_mean_squared_error
          n_jobs: -1
          n_iter: 30
          param_grid:
            n_estimators:
            - 100
            - 200
            - 400
            learning_rate:
            - 0.05
            - 0.1
            - 0.2
            max_depth:
            - 3
            - 6
            - 8
            min_child_weight:
            - 1
            - 5
            - 10
            subsample:
            - 0.7
            - 0.9
            - 1.0
            colsample_bytree:
            - 0.7
            - 0.9
            - 1.0
        model:
          name: xgboost
          library: xgboost_sklearn
          params:
            objective: reg:squarederror
            booster: gbtree
            n_estimators: 400
            learning_rate: 0.02
            max_depth: 8
            min_child_weight: 1
            subsample: 0.9
            colsample_bytree: 0.8
            colsample_bylevel: 0.7
            gamma: 0.05
            reg_alpha: 0.0
            reg_lambda: 1.5
            tree_method: hist
            verbosity: 1
            seed: 2025
            random_state: 42
            n_jobs: -1
        split:
          test_size: 0.2
          random_state: 42
    outs:
    - path: ../models/xgboost_cooling_model.joblib
      hash: md5
      md5: 738d188a2d191aef93fe41f1ca394a4c
      size: 1163229
    - path: ../models/xgboost_heating_model.joblib
      hash: md5
      md5: bf4cca5faee913e27689cbf93fc3db1a
      size: 219372
    - path: ../models/xgboost_metrics.json
      hash: md5
      md5: afdeb78cd067490c5f107082c758fba9
      size: 227
  train_random_forest:
    cmd: HOME=$(pwd)/.. python -m proyecto_final.train --config configs/rf.yaml 
      --skip-preprocessing
    deps:
    - path: ../data/processed/energy_efficiency_test_prepared.csv
      hash: md5
      md5: 77c08a5ca1a06bde232f14d5981895af
      size: 13025
    - path: ../data/processed/energy_efficiency_train_prepared.csv
      hash: md5
      md5: 559c9fcb0a9f3c4d4cd4cd5ba72e4572
      size: 52052
    - path: configs/rf.yaml
      hash: md5
      md5: 6d3b051fe2f91b79e9e39389cd2cffef
      size: 1968
    - path: modeling/trainer.py
      hash: md5
      md5: 055fad3e3d8216e0ba5d6fc3b65b682d
      size: 13297
    params:
      configs/rf.yaml:
        hpo:
          enabled: true
          search: random
          cv: 5
          scoring: neg_root_mean_squared_error
          n_jobs: -1
          n_iter: 30
          param_grid:
            n_estimators:
            - 100
            - 200
            - 400
            max_depth:
            - 
            - 5
            - 10
            - 20
            min_samples_split:
            - 2
            - 4
            - 8
            min_samples_leaf:
            - 1
            - 2
            - 4
            max_features:
            - 1.0
            - sqrt
            - log2
        model:
          name: random_forest
          library: sklearn
          params:
            n_estimators: 750
            criterion: absolute_error
            max_depth: 12
            min_samples_split: 10
            min_samples_leaf: 5
            max_features: 0.6
            random_state: 42
            n_jobs: -1
            bootstrap: true
            max_samples: 0.7
            oob_score: false
            warm_start: true
            ccp_alpha: 0.001
            max_leaf_nodes: 200
        split:
          test_size: 0.2
          random_state: 42
    outs:
    - path: ../models/random_forest_cooling_model.joblib
      hash: md5
      md5: 42c8e51409e729b2e020c9f0bbead81b
      size: 8985729
    - path: ../models/random_forest_heating_model.joblib
      hash: md5
      md5: 03ffd30dbe4af684fc7823e2485a059c
      size: 7429809
    - path: ../models/random_forest_metrics.json
      hash: md5
      md5: ba08acb39f7083fd029f58987635cd61
      size: 223
